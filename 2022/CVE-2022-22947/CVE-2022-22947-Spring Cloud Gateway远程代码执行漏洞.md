# T1190-CVE-2022-22947-Spring Cloud Gateway远程代码执行漏洞

## 来自ATT&CK的描述

使用软件，数据或命令来利用面向Internet的计算机系统或程序中的弱点，从而导致意外或无法预期的行为。系统的弱点可能是错误、故障或设计漏洞。这些应用程序通常是网站，但是可以包括数据库（例如SQL），标准服务（例如SMB 或SSH）以及具有Internet可访问开放的任何其他应用程序，例如Web服务器和相关服务。根据所利用的缺陷，这可能包括“利用防御防卫”。

如果应用程序托管在基于云的基础架构上，则对其进行利用可能会导致基础实际应用受到损害。这可以使攻击者获得访问云API或利用弱身份和访问管理策略的路径。

对于网站和数据库，OWASP排名前10位和CWE排名前25位突出了最常见的基于Web的漏洞。

## 测试案例

### 简介

2022年3月1日，VMware官方发布漏洞报告，在使用Spring Colud Gateway的应用程序开启、暴露Gateway Actuator端点时，会容易造成代码注入攻击，攻击者可以制造恶意请求，在远程主机进行任意远程执行。

### 受影响版本

```yml
Spring Cloud Gateway 3.1.x < 3.1.1
Spring Cloud Gateway 3.0.x < 3.0.7
旧的、不受支持的版本也会受到影响
```

### EXP/POC

请勿用做非法用途，仅用于检测测试。

已公开Poc：

```yml
https://github.com/lucksec/Spring-Cloud-Gateway-CVE-2022-22947
```

## 检测日志

HTTP.log

## 测试复现

```bash
sudo python3 spring_cloud_RCE.py  http://123.*.*.*:*

usage: python3 test.py url

{"predicate":"RouteDefinitionRouteLocator$$Lambda$1054/1342702643","route_id":"hacktest","filters":["[[AddResponseHeader Result = 'uid=0(root) gid=0(root) groups=0(root)\n'], order = 1]"],"uri":"http://example.com:80","order":0}
```

## 测试留痕

[流量包下载地址](https://github.com/Network-security-data-sharing/Attack-traffic-PACPs/tree/main/2022/CVE-2022-22947 Spring Cloud Gateway远程代码执行.pcapng)

## 参考推荐

MITRE-ATT&CK-T1190

<https://attack.mitre.org/techniques/T1190/>

Spring-Cloud-Gateway-CVE-2022-22947

<https://github.com/lucksec/Spring-Cloud-Gateway-CVE-2022-22947>

CVE-2022-22947远程代码执行漏洞复现分析

<https://www.freebuf.com/vuls/324386.html>
